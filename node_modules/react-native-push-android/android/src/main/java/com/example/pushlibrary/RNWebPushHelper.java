package com.example.pushlibrary;

import android.app.Service;
import android.content.Context;

import com.dhms.websocket.WebSocketNative;
import com.example.common.StringUtil;
import com.example.notification.RNNotificationService;

/**
 * Created by liuxy on 16/10/25.
 */

public class RNWebPushHelper {

    private static RNWebPushHelper instance;
    private Context mContext;

    private WebSocketNative mWebSocketNative;

    private RNWebPushHelper(Context context){
       this.mContext = context;
    }

    void startForeground(Service service){
        RNNotificationService.getInstance(mContext).onBind(service);
    }

    void stopForeground(Service service){
        RNNotificationService.getInstance(mContext).onUnBind(service);
    }

    void showNotification(String message){
        RNNotificationService.getInstance(mContext).showNotification(message);
    }

    void startWebSocket(){
        String url="ws://dev.devicehms.com:9864";
        mWebSocketNative = new WebSocketNative(url, new WebSocketNative.Listener() {
            @Override
            public void onOpen(String url) {
                mWebSocketNative.send(StringUtil.hex2Bytes("15995440857"));
            }

            @Override
            public void onClose(String url) {

            }

            @Override
            public void onError(String url, String error) {

            }

            @Override
            public void onMessage(String url, byte[] data) {
                RNWebPushHelper.this.showNotification(new String(data));
            }
        });
        mWebSocketNative.start();
    }

    void stopWebSocket(){
        mWebSocketNative.stop();
    }

    static RNWebPushHelper getInstance(Context context){
        if (instance == null){
            synchronized (RNWebPushHelper.class){
                if (instance == null){
                    instance = new RNWebPushHelper(context.getApplicationContext());
                }
            }
        }
        return instance;
    }

}
