package com.example.pushlibrary;

import android.app.Service;
import android.content.Context;

import com.dhms.websocket.WebSocketNative;
import com.example.notification.RNNotificationService;

/**
 * Created by liuxy on 16/10/25.
 */

public class RNWebsocketPushHelper {

    private static RNWebsocketPushHelper instance;
    private Context mContext;

    private WebSocketNative mWebSocketNative;

    private RNWebsocketPushHelper(Context context){
       this.mContext = context;
    }

    void startForeground(Service service){
        RNNotificationService.getInstance(mContext).onBind(service);
    }

    void stopForeground(Service service){
        RNNotificationService.getInstance(mContext).onUnBind(service);
    }

    void showNotification(String message){
        RNNotificationService.getInstance(mContext).showNotification(message);
    }

    void startWebSocket(){
        String url="ws://dev.devicehms.com:9864";
        mWebSocketNative = new WebSocketNative(url, new WebSocketNative.Listener() {
            @Override
            public void onOpen(String url) {
                mWebSocketNative.send("8117".getBytes());
            }

            @Override
            public void onClose(String url) {

            }

            @Override
            public void onError(String url, String error) {

            }

            @Override
            public void onMessage(String url, byte[] data) {
                RNWebsocketPushHelper.this.showNotification(new String(data));
            }
        });
        mWebSocketNative.start();
    }

    void stopWebSocket(){
        if (mWebSocketNative == null)
            return;
        mWebSocketNative.stop();
    }

    static RNWebsocketPushHelper getInstance(Context context){
        if (instance == null){
            synchronized (RNWebsocketPushHelper.class){
                if (instance == null){
                    instance = new RNWebsocketPushHelper(context.getApplicationContext());
                }
            }
        }
        return instance;
    }

}
